<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>فاتورة عيادات النخبة الطبية</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .invoice {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 24px 32px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.08);
    }
    h1 {
      font-size: 20px;
      margin: 0;
    }
    .header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
    }
    .clinic-info {
      font-size: 13px;
      line-height: 1.4;
    }
    .meta {
      font-size: 13px;
      line-height: 1.6;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 8px;
    }
    th {
      background: #f0f0f0;
    }
    .notes {
      margin-top: 18px;
      font-size: 13px;
    }
    .notes-label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="invoice">
    <div class="header">
      <div>
        <h1>عيادات النخبة الطبية</h1>
        <div class="clinic-info">
          العراق / ميسان / العمارة - شارع التانكي<br />
          هاتف: 07706617872
        </div>
      </div>
      <div class="meta">
        <div>اسم المراجع: <span id="customer"></span></div>
        <div>رقم الوصل: <span id="invoiceNo"></span></div>
        <div>التاريخ: <span id="dateTime"></span></div>
      </div>
    </div>

    <h2 style="font-size: 16px; margin: 8px 0 4px;">فاتورة تجميلية</h2>

    <table>
      <thead>
        <tr>
          <th style="width:40px;">#</th>
          <th>الخدمة</th>
          <th style="width:70px;">العدد</th>
          <th style="width:90px;">سعر الوحدة</th>
          <th style="width:90px;">الإجمالي</th>
        </tr>
      </thead>
      <tbody id="lines-body"></tbody>
    </table>

    <div class="notes">
      <span class="notes-label">الملاحظات:</span>
      <span id="notes"></span>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);

    // نقرأ البراميترات بنفس الأسماء بالضبط من الرابط (بحرف كبير)
    const customer = params.get("Customer") || "";
    const invoiceNo = params.get("InvoiceNo") || "";
    const dateTime = params.get("DateTime") || "";
    const notes = params.get("Notes") || "";
    const linesParam = params.get("Lines") || "";

    document.getElementById("customer").textContent = decodeURIComponent(customer);
    document.getElementById("invoiceNo").textContent = decodeURIComponent(invoiceNo);
    document.getElementById("dateTime").textContent = decodeURIComponent(dateTime);
    document.getElementById("notes").textContent = decodeURIComponent(notes);

    const tbody = document.getElementById("lines-body");

    if (linesParam) {
      // AppSheet أصلاً مرسلها ENCODEURL، فنفك التشفير و نقسم حسب سطر جديد
      const decoded = decodeURIComponent(linesParam);
      const rows = decoded.split(/\n+/).filter(r => r.trim() !== "");

      rows.forEach((rowText, index) => {
        const tr = document.createElement("tr");

        // حالياً: نخلي النص كامل في عمود "الخدمة"
        // بعدين نقدر نفصّل الكمية والسعر إذا غيرنا فورمات LineSummary
        const tdIndex = document.createElement("td");
        tdIndex.textContent = index + 1;

        const tdService = document.createElement("td");
        tdService.textContent = rowText;

        const tdQty = document.createElement("td");
        const tdUnit = document.createElement("td");
        const tdTotal = document.createElement("td");

        tr.append(tdIndex, tdService, tdQty, tdUnit, tdTotal);
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
